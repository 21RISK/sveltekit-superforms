# 1.0.0-rc.1

After plenty of work, the first release candidate for **Superforms 1.0** is ready!

First a feature list, so you'll see what's new, then a comprehensive migration guide.

## New and updated features

### Automatic form id

Setting a form `id` for multiple forms is not required anymore when using `use:enhance`, unless the forms are using the same schema.

```diff
const loginForm = await superValidate(loginSchema, {
-    id: 'loginForm'
});

const registerForm = await superValidate(registerSchema, {
-    id: 'registerForm'
});
```

Without `use:enhance`, an id can be specified in the options or in a hidden form field called `__superform_id`.

For extra safety, a warning will be emitted if identical id's are detected.

### defaultValues

This method will provide you with the default values for a schema.

```ts
import { defaultValues } from 'sveltekit-superforms/server'

const schema = z.object({ ... })
const defaults = defaultValues(schema)
```

This was previously an undocumented function called `defaultData`. If you've used it, rename it to `defaultValues`.

### superValidateSync

When using `superValidate` on the client, you previously had to use a `+page.ts` file to call `superValidate`, since it is asynchronous. But now you can import `superValidateSync` and use it in components directly. Can be very convenient in SPA:s.

```svelte
<script lang="ts">
  import { schema } from '$lib/schemas';
  import { superValidateSync, superForm } from 'sveltekit-superforms/client';

  const validation = superValidateSync(schema);
  const form = superForm(validation);
</script>
```

### String path accessors

When you wanted to set errors, use proxies and nested data in components, the array syntax was a bit clunky. It has now been replaced with a typesafe string path, so you can write it just as you would access an object property:

```diff
import { setError } from 'sveltekit-superforms/server'

const i = 1;

- setError(form, ['tags', i, 'name'], 'Incorrect name');
+ setError(form, `tags[${i}].name`, 'Incorrect name');
```

```diff
import { intProxy } from 'sveltekit-superforms/client'

const { form } = superForm(data.form);
- const idProxy = intProxy(form, ['user', 'profile', 'id']);
+ const idProxy = intProxy(form, 'user.profile.id');
```

# Migration guide

Lists the breaking changes that you need to address to upgrade from v0.8.

The guide is written with the affected methods in the headlines, so you can scan through them and apply the changes if you're using them in your code.

## setError

The `setError` function doesn't handle form-level errors anymore, because it conflicts with client-side validation. Use refine/superRefine on the schema, or the `message` helper instead.

```ts
const schema = z
  .object({
    password: z.string().min(8),
    confirmPassword: z.string()
  })
  .refine((data) => password == confirmPassword, `Passwords doesn't match.`);
```

The above will be available on the client as `$errors._errors` as before, and will be removed (or added) upon client-side validation.

```ts
const form = await superValidate(request, schema);

if (!form.valid) return fail(400, { form });

if (form.data.password != form.data.confirmPassword)
  return message(form, `Passwords doesn't match`, { status: 400 });
```

Unlike form-level messages, `message` will persist until the next form submission.

## validate, setError, proxy methods (ending with `Proxy`)

`FieldPath` is gone - the above methods are now using a string accessor like `tags[2].id` instead of an array like `['tags', 2, 'id']`.

```diff
- setError(form, ['tags', i, 'name'], 'Incorrect name');
+ setError(form, `tags[${i}].name`, 'Incorrect name');
```

This also applies to generic components, so you should change the type of the field prop, as described on the componentization page:

```svelte
<script lang="ts">
  import type { z, AnyZodObject } from 'zod';
  import type { UnwrapEffects } from 'sveltekit-superforms';
  import type { SuperForm, StringPath } from 'sveltekit-superforms/client';
  import { formFieldProxy } from 'sveltekit-superforms/client';

  type T = $$Generic<AnyZodObject>;

  export let form: SuperForm<UnwrapEffects<T>, unknown>;
  export let field: string & StringPath<z.infer<UnwrapEffects<T>>>;

  const { path, value, errors, constraints } = formFieldProxy(form, field);
</script>
```

## allErrors, firstError

The signature for `allErrors` and `firstError` has changed, to make it easier to group related messages:

```diff
- { path: string[]; message: string[] }
+ { path: string; messages: string[] }
```

The path follows the same format as the string accessor path above.

```svelte
{#if $allErrors.length}
  <ul>
    {#each $allErrors as error}
      <li>
        <b>{error.path}:</b>
        {error.messages}
      </li>
    {/each}
  </ul>
{/if}
```

## defaultData

The `defaultData` function is now called `defaultValues`.

```diff
- import { defaultData } from 'sveltekit-superforms/server`
+ import { defaultValues } from 'sveltekit-superforms/server`
```

## meta

The virtually unused `meta` store has been removed. Use the Zod schema directly instead for reflection.

## Client options

The following `superForm` options have changed:

### resetForm

Resetting the form now works without `use:enhance`! Just set the option to `true` and it will work.

If you have used the function version of `resetForm`, `() => boolean`, it is now synchronous.

### errorSelector

The default `errorSelector` is now `[data-invalid],[aria-invalid="true"]`, so if you want to be more accessibility-friendly:

```diff
<input
  name="name"
  bind:value={$form.name}
- data-invalid={$errors.name}
+ aria-invalid={$errors.name ? 'true' : undefined}
/>
```

## Server options

The following `superValidate` options have changed:

### noErrors

`noErrors` is removed from the options. Use `errors` instead to determine if errors should be added or not to the validation.

```ts
// Add errors to an empty form
const form = await superValidate(schema, { errors: true });
```

The [changelog](https://github.com/ciscoheat/sveltekit-superforms/blob/main/CHANGELOG.md) has a full list of changes that aren't breaking. So please try this release candidate, and let me know in a [Github issue](https://github.com/ciscoheat/sveltekit-superforms/issues) or on [Discord](https://discord.gg/AptebvVuhB) if you find some problem. Thank you for helping out towards 1.0!
